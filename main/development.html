<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Development &mdash; req2flatpak 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changelog" href="changelog.html" />
    <link rel="prev" title="Using the Python API" href="api.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            req2flatpak
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Using the Commandline Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Using the Python API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-the-source-code">Obtaining the Source Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-python">Installing Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-a-development-environment">Setting up a Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-development-version">Running a Development Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#understanding-the-architecture-and-design-goals">Understanding the Architecture and Design Goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modifying-and-contributing-code">Modifying and Contributing Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ensuring-code-quality">Ensuring Code quality</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-dependencies">Updating Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ci-dependencies">CI dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#poetry-and-pre-commit-dependencies">Poetry and pre-commit dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#publishing-a-release">Publishing a Release</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">req2flatpak</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Development</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/development.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this heading"></a></h1>
<p>If you want to work on req2flatpak, this section helps you get started.</p>
<p>req2flatpak is developed in an open-source, community-driven way,
as a voluntary effort in the authors’ free time.
All contributions are greatly appreciated…
pull requests are welcome, and so are bug reports and suggestions for improvement.</p>
<section id="obtaining-the-source-code">
<h2>Obtaining the Source Code<a class="headerlink" href="#obtaining-the-source-code" title="Permalink to this heading"></a></h2>
<p>req2flatpak’s original source code lives in this github repository:
<a class="reference external" href="https://github.com/johannesjh/req2flatpak">https://github.com/johannesjh/req2flatpak</a>.
You can download the source code by cloning the git repository.</p>
</section>
<section id="installing-python">
<h2>Installing Python<a class="headerlink" href="#installing-python" title="Permalink to this heading"></a></h2>
<p>Most systems come with python pre-installed.
You can use this python version to develop req2flatpak.</p>
<p>It can be useful to install a specific (older) version of python
to make sure req2flatpak stays compatible with older targeted python versions.</p>
<ul class="simple">
<li><p>Python versions targeted by req2flatpak are defined in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file.</p></li>
<li><p>You can use <a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a>
to install various python versions for use in a virtual environment.
It is a good practice to install and use the oldest still supported python version
when developing req2flatpak.</p></li>
</ul>
</section>
<section id="setting-up-a-development-environment">
<h2>Setting up a Development Environment<a class="headerlink" href="#setting-up-a-development-environment" title="Permalink to this heading"></a></h2>
<p>Clone the req2flatpak git repository in the IDE of your choice.
Features and languages that the IDE should ideally support include:</p>
<ul class="simple">
<li><p>python,</p></li>
<li><p>poetry (for managing req2flatpak’s dependencies in a virtual environment),</p></li>
<li><p>devcontainers (optionally, for working inside a docker image instead of your local system), as well as</p></li>
<li><p>restructured text (optionally, for writing documentation).</p></li>
</ul>
<p>Install poetry and pre-commit using the python installer of your choice,
e.g., by running <code class="docutils literal notranslate"><span class="pre">pipx</span> <span class="pre">install</span> <span class="pre">poetry</span></code> and <code class="docutils literal notranslate"><span class="pre">pipx</span> <span class="pre">install</span> <span class="pre">pre-commit</span></code>.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">install</span> <span class="pre">--with</span> <span class="pre">lint</span> <span class="pre">--with</span> <span class="pre">docs</span> <span class="pre">--all-extras</span></code>.
This will install all the python packages you need into a python virtual environment.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code>.
This will initialize pre-commit in your local development repository.</p>
</section>
<section id="running-a-development-version">
<h2>Running a Development Version<a class="headerlink" href="#running-a-development-version" title="Permalink to this heading"></a></h2>
<p>Have a look at the commands available in req2flatpak’s <code class="docutils literal notranslate"><span class="pre">makefile</span></code>.
These commands show how to run a local req2flatpak development version,
as well as various other development-related tasks.</p>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">run</span>
<span class="nf">run</span><span class="o">:</span>
<span class="w">	</span>poetry<span class="w"> </span>run<span class="w"> </span>req2flatpak

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">lint</span>
<span class="nf">lint</span><span class="o">:</span>
<span class="w">	</span>poetry<span class="w"> </span>run<span class="w"> </span>pre-commit<span class="w"> </span>run<span class="w"> </span>--all-files

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="nf">test</span><span class="o">:</span>
<span class="w">	</span>poetry<span class="w"> </span>run<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>unittest

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">docs</span>
<span class="nf">docs</span><span class="o">:</span>
<span class="w">	</span>poetry<span class="w"> </span>run<span class="w"> </span>sphinx-build<span class="w"> </span>-v<span class="w"> </span>-b<span class="w"> </span>html<span class="w"> </span>docs/source<span class="w"> </span>docs/build/html
</pre></div>
</div>
</section>
<section id="understanding-the-architecture-and-design-goals">
<h2>Understanding the Architecture and Design Goals<a class="headerlink" href="#understanding-the-architecture-and-design-goals" title="Permalink to this heading"></a></h2>
<p>req2flatpak’s architecture implements the following design goals and design choices.</p>
<p>req2flatpak consists of just a single python file.
This allows req2flatpak to be installed by copy-pasting this file.</p>
<p>req2flatpak is packaged as a python package.
This allows req2flatpak to be installed using pip, poetry, and other similar tools.
Note, single-file python packages are not unusual:
other popular python packages like <a class="reference external" href="https://pypi.python.org/pypi/six">six</a>
also consist of a a single file only,
as explained in this <a class="reference external" href="https://softwareengineering.stackexchange.com/a/243045">stackoverflow answer</a>.</p>
<p>req2flatpak requires minimal dependencies.
The benefit is that req2flatpak runs on a variety of systems.
Optional dependencies are declared in req2flatpak’s <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file.</p>
<p>req2flatpak aims to do one thing well.
Its focus is on generating flatpak-builder build modules
for installing required python packages in a flatpak package.
Other functionality is intentionally not included in req2flatpak,
particularly if it would increase the code size or require additional dependencies.
For example, req2flatpak does not resolve dependencies, nor does it freeze dependency versions
(other tools like pip-compile and poetry are already good at this).</p>
</section>
<section id="modifying-and-contributing-code">
<h2>Modifying and Contributing Code<a class="headerlink" href="#modifying-and-contributing-code" title="Permalink to this heading"></a></h2>
<p>You are free to modify req2flatpak as you wish
(under the terms of its very permissive MIT license).
You are very welcome to contribute improvements back to the original req2flatpak.</p>
</section>
<section id="running-tests">
<h2>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this heading"></a></h2>
<p>Use the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> command to run automated tests.</p>
</section>
<section id="ensuring-code-quality">
<h2>Ensuring Code quality<a class="headerlink" href="#ensuring-code-quality" title="Permalink to this heading"></a></h2>
<p>Use <a class="reference external" href="https://pre-commit.com/">pre-commit</a> to prettify and lint the code before committing changes,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># to install pre-commit on your system,</span>
<span class="c1"># follow instructions from https://pre-commit.com/, for example:</span>
pipx<span class="w"> </span>install<span class="w"> </span>pre-commit

<span class="c1"># to install the pre-commit git hooks in the cloned req2flatpak repo</span>
pre-commit<span class="w"> </span>install<span class="w">  </span><span class="c1"># activates pre-commit in the current git repo</span>

<span class="c1"># to prettify and lint all code</span>
pre-commit<span class="w"> </span>run<span class="w"> </span>--all

<span class="c1"># to prettify and lint only staged changes</span>
pre-commit<span class="w"> </span>run
</pre></div>
</div>
<p>If this doesn’t work, you can skip specific checks by prepending <code class="docutils literal notranslate"><span class="pre">SKIP=&lt;hook-id&gt;</span></code> like so: <code class="docutils literal notranslate"><span class="pre">SKIP=poetry-lock</span> <span class="pre">git</span> <span class="pre">commit</span></code>. You can disable all hooks for a commit by using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-n</span></code> or disable pre-commit entirely for the repository with <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">uninstall</span></code>.
We welcome your contributions even if your workflow differs from what we recommend here.</p>
</section>
<section id="updating-dependencies">
<h2>Updating Dependencies<a class="headerlink" href="#updating-dependencies" title="Permalink to this heading"></a></h2>
<p>There are multiple categories of dependencies that can be found in this repository:
CI, Poetry and pre-commit hooks.</p>
<section id="ci-dependencies">
<h3>CI dependencies<a class="headerlink" href="#ci-dependencies" title="Permalink to this heading"></a></h3>
<p>Github actions and workflows contain hardcoded versions of container images and packages.
See the <code class="docutils literal notranslate"><span class="pre">.github</span></code> folder.
Currently there is no programmatic way to update the github actions we depend on.
One has to manually update the versions and/or commit hashes.</p>
<p>The devcontainer configuration file also contains versions,
these are also manually kept up-to-date.
See the <code class="docutils literal notranslate"><span class="pre">.devcontainer</span></code> folder.</p>
</section>
<section id="poetry-and-pre-commit-dependencies">
<h3>Poetry and pre-commit dependencies<a class="headerlink" href="#poetry-and-pre-commit-dependencies" title="Permalink to this heading"></a></h3>
<p>First update poetry dependencies,</p>
<ol class="arabic simple">
<li><p>Manually bump the version constraints in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">update</span> <span class="pre">--with</span> <span class="pre">lint</span></code> to update installed packages and write the lock file.</p></li>
<li><p>Stage changes by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">pyproject.toml</span> <span class="pre">poetry.lock</span></code>.</p></li>
</ol>
<p>Then update pre-commit dependencies,</p>
<ol class="arabic simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code> just to be sure that pre-commit is properly initialized.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">autoupdate</span> <span class="pre">--freeze</span></code> to update pre-commit’s packages.</p></li>
<li><p>Stage changes by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">.pre-commit-config.yaml</span></code>.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">run</span></code> to sync package versions from poetry to pre-commit. Note that this is a one-way-sync, i.e., <a class="reference external" href="https://github.com/floatingpurr/sync_with_poetry">sync_with_poetry</a> will copy package versions from the poetry lock file into the pre-commit yaml file.</p></li>
<li><p>Stage changes by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">.pre-commit-config.yaml</span></code>.</p></li>
<li><p>run <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">run</span></code> to verify that pre-commit now happily leaves all files unchanged.</p></li>
<li><p>Stage and commit all changes.</p></li>
</ol>
</section>
</section>
<section id="publishing-a-release">
<h2>Publishing a Release<a class="headerlink" href="#publishing-a-release" title="Permalink to this heading"></a></h2>
<p>Use the following steps to publish a release of req2flatpak:</p>
<ul class="simple">
<li><p>Enter the version number to be released in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>, e.g., <code class="docutils literal notranslate"><span class="pre">version</span> <span class="pre">=</span> <span class="pre">&quot;1.2.3&quot;</span></code>. Commit and push this change to a branch and create a merge request.</p></li>
<li><p>Describe the release in <code class="docutils literal notranslate"><span class="pre">docs/source/changelog.rst</span></code>. Commit and push the modified changelog in the same branch.</p></li>
<li><p>Verify that the branch builds correctly. Ideally run some manual tests. Optionally tag a release candidate by pushing a tag such as v1.2.3-rc1. If the quality looks good, merge the branch.</p></li>
<li><p>Tag the main branch with the version to be released, e.g., push a tag named <code class="docutils literal notranslate"><span class="pre">v1.2.3</span></code>.</p></li>
<li><p>Github CI will build the python package and publish it on PyPI.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api.html" class="btn btn-neutral float-left" title="Using the Python API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="changelog.html" class="btn btn-neutral float-right" title="Changelog" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, johannesjh.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   
  <div id="other-versions-div" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" style="visibility: hidden">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Other Versions</span>
      
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="other-versions-dl"/>
    </div>
  </div>
  <script>
    function addVersion(name) {
      var dd = document.createElement("dd");
      var a = document.createElement("a");
      a.href = "../" + name;
      a.innerText = name;
      dd.appendChild(a);
      document.getElementById('other-versions-dl').appendChild(dd);
    }
    // Get versions.txt and add a version for each line
    fetch("../versions.txt").then(response => {
      if (response.ok) {
        document.getElementById('other-versions-div').style.visibility = "visible";
        return response.text().then(text => text.split(/\r?\n/).forEach(addVersion))
      }
    });
  </script>


</body>
</html>